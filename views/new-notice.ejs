<%- include('partials/header') %>

<header class="main-header">
    <h1>Post a New Notice</h1>
    <nav>
        <a href="/dashboard" class="btn btn-secondary">Back to Dashboard</a>
    </nav>
</header>

<main>
    <form action="/add-notice" method="POST" enctype="multipart/form-data" class="notice-form">
        <div class="form-group">
            <label for="section">Section</label>
            <select id="section" name="section" required>
                <option value="">Select a section</option>
                <option value="announcement">Announcement</option>
                <option value="exams">Exams</option>
                <option value="placement">Placement</option>
                <option value="event">Event</option>
            </select>
        </div>
        <div class="form-group">
            <label for="title">Notice Title</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="author">Author (e.g., Placement Cell)</label>
            <input type="text" id="author" name="author" required>
        </div>
        <div class="form-group">
            <label for="content">Content</label>
            <textarea id="content" name="content" rows="10" required></textarea>
        </div>
        <div class="form-group">
            <label for="deadline">Date (DD/MM/YYYY)</label>
            <input type="text" id="deadline" name="deadline" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}">
            <small style="color: #666; font-size: 0.85em;">Format: DD/MM/YYYY (e.g., 31/12/2025). Post will be removed after this date.</small>
        </div>
        <div class="form-group">
            <label for="image">Upload Image (Optional)</label>
            <input type="file" id="image" name="image" accept="image/*">
        </div>
        <div class="form-group">
            <label for="pdf">Upload PDF (Optional)</label>
            <input type="file" id="pdf" name="pdf" accept="application/pdf">
        </div>
        <button type="submit" class="btn btn-primary">Post Notice</button>
    </form>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deadlineInput = document.getElementById('deadline');
        deadlineInput.addEventListener('change', function() {
            const dateString = this.value;
            if (dateString) {
                // Parse DD/MM/YYYY to YYYY-MM-DD for Date object
                const parts = dateString.split('/');
                if (parts.length === 3) {
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10);
                    const year = parseInt(parts[2], 10);

                    // Check for valid date parts
                    if (isNaN(day) || isNaN(month) || isNaN(year) || day < 1 || day > 31 || month < 1 || month > 12 || year < 1000) {
                        alert('Please enter a valid date in DD/MM/YYYY format.');
                        return;
                    }
                    
                    const picked = new Date(year, month - 1, day); // Month is 0-indexed
                    const today = new Date();
                    today.setHours(0, 0, 0, 0); // Normalize today's date to start of day

                    if (picked < today) {
                        alert('Warning: The selected deadline has already passed. Please choose a future date.');
                    }
                } else {
                    alert('Please enter the date in DD/MM/YYYY format.');
                }
            }
        });
    });
</script>

<%- include('partials/footer') %>